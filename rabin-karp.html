<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<title>Алгоритм Рабина-Карпа - Ксения Мальчикова</title>
</head>
<body>
	<script>
		// Алгоритм Рабина-Карпа
		class RabinKarp {
			// Функция хеширования
			polyHash(S) {
				var p = 1019
				var x = 34;
				var hash = 0
				for (var i = 0; i <= S.length - 1; i++) {
					hash = (hash * x + S.charCodeAt(i)) % p
				}
				return hash
			}
			
			// Нахождения числа вхождений подстроки
			count(T, P) {
				return this.searchAll(T, P).length
			}
			
			// Нахождения всех вхождений подстроки
			searchAll(T, P) {
				var positions = []
				var pHash = this.polyHash(P)
				var text
				var tHash

				// Основной цикл
				for (var k = 0; k <= (T.length - P.length); k++) {
					// Берем подстроку с позиции k
					text = T.slice(k, (k + P.length))
					// Вычисляем хеш-значение
					tHash = this.polyHash(text)
					// Cравниваем его с хеш-значением исходной строки
					if (pHash === tHash) {
						positions.push(k)
					}
				}
				return positions
			}
		}
		
		// строка и подстрока
		var str = 'В конце ноября, в оттепель, часов в девять утра, поезд Петербургско-Варшавской железной дороги на всех парах подходил к Петербургу. Было так сыро и туманно, что насилу рассвело; в десяти шагах, вправо и влево от дороги, трудно было разглядеть хоть что-нибудь из окон вагона. Из пассажиров были и возвращавшиеся из-за границы; но более были наполнены отделения для третьего класса, и всё людом мелким и деловым, не из очень далека. Все, как водится, устали, у всех отяжелели за ночь глаза, все назяблись, все лица были бледно-желтые, под цвет тумана. В одном из вагонов третьего класса, с рассвета, очутились друг против друга, у самого окна, два пассажира — оба люди молодые, оба почти налегке, оба не щегольски одетые, оба с довольно замечательными физиономиями и оба пожелавшие, наконец, войти друг с другом в разговор.'
		var substr = 'вагон'
		
		var rk = new RabinKarp()
		
		console.log('Строка: ' + str)
		console.log('Подстрока: ' + substr)
		console.log('Число вхождений подстроки: ' + rk.count(str, substr))
		console.log('Bсе вхождения подстроки: ' + rk.searchAll(str, substr))
	</script>
</body>
</html>